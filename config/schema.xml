<?xml version="1.0" encoding="UTF-8"?>
<database name="hhc" defaultIdMethod="native" namespace="hhc\DB">
  <table name="hero" phpName="Hero">
    <column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true" />
    <column name="name" type="varchar" size="50" required="true" />
    <column name="role" type="varchar" size="200" required="true" />
    <column name="hp" type="integer" required="true" phpName="HP" />
    <column name="dmg" type="varchar" size="20" required="true" />
    <column name="armor" type="float" size="4" scale="2" required="true" />
    <column name="difficulty" type="float" size="3" scale="1" required="true" />
    <column name="range" type="integer" required="true" />
    <column name="speed" type="integer" required="true" />
    <column name="stuns" type="integer" required="false" />
    <column name="side" type="varchar" size="20" required="true" />
    <column name="stat" type="varchar" size="10" required="true" />
    <column name="slug" type="varchar" size="255" required="false" />
  </table>

  <table name="counter" phpName="Counter">
    <column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true" />
    <column name="hid" type="integer" required="true" />
    <column name="cid" type="integer" required="true" />

    <foreign-key foreignTable="hero" phpName="Hero" refPhpName="Counter">
        <reference local="hid" foreign="id" />
    </foreign-key>
    <foreign-key foreignTable="hero" phpName="Counter">
        <reference local="cid" foreign="id" />
    </foreign-key>
  </table>

  <table name="vote" phpName="Vote">
    <column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true" />
    <column name="uid" type="integer" required="true" primaryKey="true" />
    <column name="cid" type="integer" required="true" primaryKey="true" />
    <column name="vote_type" type="ENUM" valueSet="up,down" />

    <foreign-key foreignTable="user" phpName="User" refPhpName="Vote">
        <reference local="uid" foreign="id" />
    </foreign-key>
    <foreign-key foreignTable="counter" phpName="Counter" refPhpName="Vote">
        <reference local="cid" foreign="id" />
    </foreign-key>
  </table>

  <table name="user" phpName="User">
    <column name="id" type="integer" required="true" primaryKey="true" autoIncrement="true" />
    <column name="username" type="varchar" size="255" required="true" />
    <column name="email" type="varchar" size="255" required="true" />
    <column name="password" type="varchar" size="255" />
    <column name="roles" type="ENUM" valueSet="USER_ROLE,ADMIN_ROLE" />
    <unique name="unique_username">
        <unique-column name="username" />
    </unique>
    <validator column="username">
        <rule name="unique" message="Username already exists!" />
    </validator>
    <validator column="email">
        <rule name="unique" message="E-mail already exists!" />
        <rule name="match"
            value="/^([a-zA-Z0-9])+([\.a-zA-Z0-9_-])*@([a-zA-Z0-9])+(\.[a-zA-Z0-9_-]+)+$/"
            message="Please enter a valid email address." />
    </validator>
  </table>
</database>
